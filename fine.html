<!doctype html>
<html class="no-js">
	<head>
		<title>Fines</title>
		<script type="text/javascript" src="scripts/knockout-2.2.1.min.js"></script>
	</head>
	<body>
		<div>
			<!-- Fine Band -->
			<label><input type="radio" name="band" value="0.5" data-bind="checked: percentage" />A</label>
			<label><input type="radio" name="band" value="1.0" data-bind="checked: percentage" />B</label>
			<label><input type="radio" name="band" value="1.5" data-bind="checked: percentage" />C</label>
			<label><input type="radio" name="band" value="2.5" data-bind="checked: percentage" />D</label>
			<label><input type="radio" name="band" value="4.0" data-bind="checked: percentage" />E</label>
		</div>
		<div>
			<label>Income
				<input type="number" data-bind="value: income"/>
			</label>
		</div>
		<div>
			<!-- Income buttons -->
			<label><input type="radio" name="incomePeriod" value="annual" data-bind="checked: incomePeriod" />Annual</label>
			<label><input type="radio" name="incomePeriod" value="monthly" data-bind="checked: incomePeriod" />Monthly</label>
			<label><input type="radio" name="incomePeriod" value="weekly" data-bind="checked: incomePeriod" />Weekly</label>
			<button data-bind="click: defaultIncome">£400</button>
			<button data-bind="click: defaultUnemployedIncome">£110</button>
		</div>
		<div>
			<label>Multiplier
				<input type="number" data-bind="value: percentage"/>
			</label>
		</div>
		<div>
			<!-- Discount -->
			<label><input type="radio" name="discount" value="0.6666666666" data-bind="checked: discount" />33%</label>
			<label><input type="radio" name="discount" value="0.75" data-bind="checked: discount" />25%</label>
			<label><input type="radio" name="discount" value="0.9" data-bind="checked: discount" />10%</label>
			<label><input type="radio" name="discount" value="1.0" data-bind="checked: discount" />Not Guilty</label>
		</div>
		<div>
			<label>Fine</label>
			<span data-bind="text: fine"></span>
		</div>
		<div>
			<!-- Other eg. compensation -->
			<label>Other
				<input type="number" data-bind="value: other"/>
			</label>
		</div>
		<div>
			<label>Court Costs</label>
			<input type="number" data-bind="value: courtCosts"/>
		</div>
		<div>
			<label>Victim Surcharge</label>
			<span data-bind="text: victimSurcharge"/>
		</div>
		<div>
			<label>Total</label>
			<span data-bind="text: total"></span>
		</div>


		<script type="text/javascript">
			function FineCalculatorViewModel(){
				this.courtCosts = ko.observable( 85 );			
				this.percentage = ko.observable( 1.50 );
				this.discount = ko.observable( 1.0 );
				this.other = ko.observable( 0.0 );

				this.income = ko.observable( 400 );
				this.incomePeriod = ko.observable( 'weekly' );
				this.weeklyIncome = ko.computed( function(){
					if( this.incomePeriod() === 'annual')
					{
						return this.income() / 52;
					}
					else if (this.incomePeriod() === 'monthly')
					{
						return this.income() * 12 / 52;
					}
					return this.income();
				}, this );


				this.fine = ko.computed( function(){
					return this.weeklyIncome() * this.percentage() * this.discount();
				}, this);

				this.victimSurcharge = ko.computed( function(){
					var calculated = this.fine() * 0.1;
					if ( calculated < 20 )
						return 20;
					if ( calculated > 120 )
						return 120;
					return calculated;
				}, this);

				this.total = ko.computed( function(){
					return Number(this.fine()) + Number(this.other() ) +  Number(this.courtCosts()) + Number(this.victimSurcharge());
				}, this);

				// methds
				this.defaultIncome = function(){
					this.income(400);
					this.incomePeriod('weekly');
				};

				this.defaultUnemployedIncome = function () {
					this.income(110);
					this.incomePeriod('weekly');
				};
			}

			ko.applyBindings(new FineCalculatorViewModel());
		</script>
	</body>
</html>
